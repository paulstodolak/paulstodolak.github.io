var JACKNIFE=JACKNIFE||{};!function($){$(document).ready(function(){$(".table-filter, .table-sort").each(function(){var TableController=new JACKNIFE.TableController($(this));TableController.init(),$(this).data("TableController",TableController)})})}(jQuery),function($){JACKNIFE.TableController=function(el){var $el=$(el),$body=$("tbody",$el),$sort_triggers=$(".sort-trigger",$el),$filter_triggers=$('select[data-filter-table="'+$el.attr("id")+'"]'),sort_direction="DESC",sort_type="default",date_format=$el.data("date-format")?$el.data("date-format").toUpperCase():"DMY",original_rows=$("tr",$body).toArray(),selected_rows=original_rows;this.init=function(){if($sort_triggers){$sort_triggers.on("click",_sort_click);var $target=$(".sort-trigger.active",$el);if($target){var index=$target.index();_set_sort_type($target),selected_rows=_sort_rows(selected_rows,index),_update_table(selected_rows)}}$filter_triggers&&$filter_triggers.on("change",_filter_change)};var _sort_click=function(e){e.preventDefault();var $target=$(this),index=$target.index();_set_sort_direction($target),_set_sort_type($target),selected_rows=_sort_rows(selected_rows,index),_update_table(selected_rows)},_filter_change=function(e){e.preventDefault();$(this);selected_rows=_filter_rows();var $sort_target=$(".sort-trigger.active",$el);if($sort_target){var index=$sort_target.index();selected_rows=_sort_rows(selected_rows,index)}_update_table(selected_rows)},_sort_rows=function(rows,index){return rows=rows.sort(_compare_cells(index)),"DESC"===sort_direction&&(rows=rows.reverse()),rows},_filter_rows=function(){for(var rows=new Array,i=0;i<original_rows.length;i++){var add_row=!0;$filter_triggers.each(function(){var $trigger=$(this),column=$trigger.data("filter-column"),values=Array.isArray($trigger.val())?$trigger.val():new Array($trigger.val()),target=_get_cell_value(original_rows[i],column),is_default=null===values[0]||-1!=$.inArray("default",values),is_match=-1!=$.inArray(target,values);is_default||is_match||(add_row=!1)}),!0===add_row&&rows.push(original_rows[i])}return rows},_set_sort_direction=function($target){$target.hasClass("active")?$target.hasClass("sort-asc")?($target.removeClass("sort-asc"),$target.addClass("sort-desc"),sort_direction="DESC"):$target.hasClass("sort-desc")&&($target.removeClass("sort-desc"),$target.addClass("sort-asc"),sort_direction="ASC"):($sort_triggers.removeClass("active sort-desc sort-asc"),$target.addClass("active sort-desc"),sort_direction="DESC")},_set_sort_type=function($target){sort_type=$target.data("sort")?$target.data("sort"):"default"},_compare_cells=function(index){return function(a,b){var valA=_get_cell_value(a,index),valB=_get_cell_value(b,index);return"date"===sort_type?(valA=_format_date(valA))-(valB=_format_date(valB)):$.isNumeric(valA)&&$.isNumeric(valB)?valB:(valA=valA.toString(),valB=valB.toString(),valA.localeCompare(valB))}},_get_cell_value=function(row,index){return $("td",row).eq(index).text()},_format_date=function(str){var date,day,month,year;if(!((str=(str=(str=str.toLowerCase()).replace(/^[^a-z0-9]*/,"")).replace(/[^a-z0-9]*$/,"")).length<1||(date=(str=str.replace(/[^a-z0-9]+/g,",")).split(",")).length<3)){for(var i=0;i<3;i++){var target=date_format.substr(i,1);"D"===target?day=date[i]:"M"===target?month=date[i]:"Y"===target&&(year=date[i])}(day=day.replace(/^0/,""))<10&&(day="0"+day);if(/[a-z]/.test(month))switch(month=month.substr(0,3)){case"jan":month=String(1);break;case"feb":month=String(2);break;case"mar":month=String(3);break;case"apr":month=String(4);break;case"may":month=String(5);break;case"jun":month=String(6);break;case"jul":month=String(7);break;case"aug":month=String(8);break;case"sep":month=String(9);break;case"oct":month=String(10);break;case"nov":month=String(11);break;case"dec":month=String(12);break;default:month=String(0)}return(month=month.replace(/^0/,""))<10&&(month="0"+month),(year=parseInt(year))<100&&(year=parseInt(year)+2e3),""+String(year)+String(month)+String(day)}},_update_table=function(rows){$body.empty();for(var i=0;i<rows.length;i++)$body.append(rows[i])}}}(jQuery);